(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();function Bt(e=6){const n="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let i=0;i<e;i++)a+=n.charAt(Math.floor(Math.random()*n.length));return a}const Nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function $(e){if(e===0||e===null||isNaN(e))return"";let n="";for(;e>0;)n=Nt[e%64]+n,e=Math.floor(e/64);return n}function C(e){if(!e)return 0;let n=0;for(let a=0;a<e.length;a++)n=n*64+Nt.indexOf(e[a]);return n}const E={apiKey:"DEMO_KEY",authDomain:"online-timer-demo.firebaseapp.com",databaseURL:"https://online-timer-demo-default-rtdb.firebaseio.com",projectId:"online-timer-demo",storageBucket:"online-timer-demo.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:abcdef"};let p;try{const e=initializeApp(E);p=getDatabase(e)}catch(e){console.warn("Firebase initialization failed. Using local mode.",e)}(!window.name||!window.name.startsWith("OnlineTimer_"))&&(window.name="OnlineTimer_"+Bt(12));const $t=window.name,t={view:"landing",type:"countdown",countdownMode:"duration",roomId:null,isCreator:!1,timerActive:!1,startTime:null,pauseTime:0,duration:600,remoteState:null,isStandalone:!1,bc:null,stopwatchMode:"immediate",actualStartTime:null,timerName:"",lastIsWaiting:!1},Ct=document.getElementById("landing-view"),xt=document.getElementById("timer-view"),_=document.getElementById("create-btn"),j=document.getElementById("type-countdown"),G=document.getElementById("type-stopwatch"),mt=document.getElementById("countdown-settings"),ut=document.getElementById("stopwatch-settings"),At=document.getElementById("countdown-minutes"),Dt=document.getElementById("countdown-hours"),kt=document.getElementById("countdown-seconds"),gt=document.getElementById("timer-display"),h=document.getElementById("toggle-btn"),w=document.getElementById("reset-btn"),qt=document.getElementById("back-to-home"),Ut=document.getElementById("share-btn");document.getElementById("room-id-display");const y=document.getElementById("sync-status"),Jt=document.getElementById("timer-type-label"),F=document.getElementById("controls"),O=document.getElementById("viewer-controls"),Q=document.getElementById("mode-duration"),z=document.getElementById("mode-target"),pt=document.getElementById("duration-input-group"),ft=document.getElementById("target-input-group"),Ot=document.getElementById("target-date"),A=document.getElementById("target-ampm"),L=document.getElementById("target-hour"),R=document.getElementById("target-minute"),ct=document.getElementById("target-second"),Z=document.getElementById("sw-mode-immediate"),X=document.getElementById("sw-mode-target"),ht=document.getElementById("sw-target-input-group"),Pt=document.getElementById("sw-target-date"),D=document.getElementById("sw-target-ampm"),I=document.getElementById("sw-target-hour"),H=document.getElementById("sw-target-minute"),dt=document.getElementById("sw-target-second"),f=document.getElementById("timer-info"),tt=document.getElementById("timer-name-input"),Yt=document.getElementById("timer-name-display"),Tt=document.getElementById("timer-list-section"),vt=document.getElementById("timer-list-container"),V=document.getElementById("share-modal"),Ft=document.getElementById("close-modal-btn"),M=document.getElementById("share-online-btn"),_t=document.getElementById("share-standalone-btn"),yt=document.getElementById("share-subtitle"),K=document.getElementById("share-standalone-label"),et=document.getElementById("change-target-btn"),nt=document.getElementById("change-target-modal"),Wt=document.getElementById("cancel-change-btn"),jt=document.getElementById("confirm-change-btn"),Rt=document.getElementById("new-target-date"),x=document.getElementById("new-target-ampm"),S=document.getElementById("new-target-hour"),at=document.getElementById("new-target-minute"),it=document.getElementById("new-target-second"),Gt=document.getElementById("theme-toggle"),wt=document.getElementById("theme-icon-sun"),St=document.getElementById("theme-icon-moon");function Qt(){ue(),It(),window.addEventListener("hashchange",It),zt(),ie(),de();const e=new Date;e.setHours(e.getHours()+1);let n=e.getHours();const a=n>=12?"PM":"AM";n=n%12,n=n||12;const i=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");Ot.value=`${i}-${o}-${s}`,A.value=a,L.value=n,R.value=e.getMinutes().toString().padStart(2,"0"),ct.value="00",Pt.value=`${i}-${o}-${s}`,D.value=a,I.value=n,H.value=e.getMinutes().toString().padStart(2,"0"),dt.value="00"}function zt(){j.addEventListener("click",()=>st("countdown")),G.addEventListener("click",()=>st("stopwatch")),Q.addEventListener("click",()=>Lt("duration")),z.addEventListener("click",()=>Lt("target")),_.addEventListener("click",te),qt.addEventListener("click",()=>window.location.hash=""),h.addEventListener("click",ne),w.addEventListener("click",ae),Ut.addEventListener("click",()=>{const a=t.type==="countdown"?"타이머":"스톱워치";K.textContent=`${a} 링크 복사`,V.classList.remove("hidden")}),Ft.addEventListener("click",()=>V.classList.add("hidden")),M.addEventListener("click",()=>Mt(!1)),_t.addEventListener("click",()=>Mt(!0)),Z.addEventListener("click",()=>ot("immediate")),X.addEventListener("click",()=>ot("target"));const e=(a,i,o)=>{a.addEventListener("input",()=>{let s=parseInt(a.value);isNaN(s)||(s<i&&(a.value=i),s>o&&(a.value=o))}),a.addEventListener("blur",()=>{a.value===""&&(a.value=i)})};e(Dt,0,99),e(At,0,59),e(kt,0,59),e(L,1,12),e(R,0,59),e(ct,0,59),e(I,1,12),e(H,0,59),e(dt,0,59);let n;L.addEventListener("input",a=>{clearTimeout(n);const i=parseInt(a.target.value);isNaN(i)||(n=setTimeout(()=>{i>=13&&i<=23?(A.value="PM",L.value=i-12):i===0?(A.value="AM",L.value=12):i===12?A.value="PM":i>=24&&(L.value=12)},300))}),R.addEventListener("blur",a=>{let i=parseInt(a.target.value);isNaN(i)?a.target.value="00":a.target.value=Math.min(59,Math.max(0,i)).toString().padStart(2,"0")}),I.addEventListener("input",a=>{clearTimeout(n);const i=parseInt(a.target.value);isNaN(i)||(n=setTimeout(()=>{i>=13&&i<=23?(D.value="PM",I.value=i-12):i===0?(D.value="AM",I.value=12):i===12?D.value="PM":i>=24&&(I.value=12)},300))}),H.addEventListener("blur",a=>{let i=parseInt(a.target.value);isNaN(i)?a.target.value="00":a.target.value=Math.min(59,Math.max(0,i)).toString().padStart(2,"0")}),et.addEventListener("click",()=>{if(t.startTime&&t.pauseTime){const a=new Date(t.startTime+t.pauseTime*1e3);Rt.value=a.toISOString().split("T")[0];let i=a.getHours();const o=i>=12?"PM":"AM";i=i%12||12,x.value=o,S.value=i,at.value=a.getMinutes().toString().padStart(2,"0"),it.value=a.getSeconds().toString().padStart(2,"0")}nt.classList.remove("hidden")}),Wt.addEventListener("click",()=>nt.classList.add("hidden")),jt.addEventListener("click",ee),e(S,1,12),e(at,0,59),e(it,0,59),S.addEventListener("input",a=>{clearTimeout(n);const i=parseInt(a.target.value);isNaN(i)||(n=setTimeout(()=>{i>=13&&i<=23?(x.value="PM",S.value=i-12):i===0?(x.value="AM",S.value=12):i===12?x.value="PM":i>=24&&(S.value=12)},300))})}function Lt(e){t.countdownMode=e,e==="duration"?(Q.classList.add("active"),z.classList.remove("active"),pt.classList.remove("hidden"),ft.classList.add("hidden")):(z.classList.add("active"),Q.classList.remove("active"),ft.classList.remove("hidden"),pt.classList.add("hidden"))}function ot(e){t.stopwatchMode=e,e==="immediate"?(Z.classList.add("active"),X.classList.remove("active"),ht.classList.add("hidden"),_.textContent="스톱워치 시작하기"):(X.classList.add("active"),Z.classList.remove("active"),ht.classList.remove("hidden"),_.textContent="스톱워치 생성하기")}function st(e){t.type=e,e==="countdown"?(j.classList.add("active"),G.classList.remove("active"),mt.classList.remove("hidden"),ut.classList.add("hidden"),_.textContent="타이머 생성하기",tt.placeholder="타이머 이름을 입력하세요"):(G.classList.add("active"),j.classList.remove("active"),mt.classList.add("hidden"),ut.classList.remove("hidden"),ot(t.stopwatchMode),tt.placeholder="스톱워치 이름을 입력하세요")}function It(){const e=window.location.hash;if(console.log("[Timer] Route changed:",e),e.startsWith("#*")||e.startsWith("#/+")){const n=e.startsWith("#*"),a=e.substring(n?2:3);Et("standalone",new URLSearchParams(`v=${a}`));return}if(e.startsWith("#/")){const n=e.substring(2),[a,i]=n.split("?"),o=a.replace(/\/$/,""),s=new URLSearchParams(i);Et(o,s)}else Zt()}function Zt(){t.view="landing",Ct.classList.remove("hidden"),xt.classList.add("hidden"),t.timerActive=!1,t.roomId=null,t.isCreator=!1,st("countdown")}function Xt(e){t.view="timer",Ct.classList.add("hidden"),xt.classList.remove("hidden")}async function te(){const e=Bt(6);t.isCreator=!0,t.roomId=e;let n=0,a=!1;if(t.type==="countdown")if(t.countdownMode==="duration"){const o=parseInt(Dt.value)||0,s=parseInt(At.value)||0,c=parseInt(kt.value)||0;if(n=o*3600+s*60+c,n<=0){alert("시간을 1초 이상으로 설정해주세요.");return}t.startTime=Date.now(),a=!1}else{const o=Ot.value;let s=parseInt(L.value)||12;const c=R.value||"00",r=ct.value||"00",l=A.value;l==="PM"&&s<12&&(s+=12),l==="AM"&&s===12&&(s=0);const u=new Date(`${o}T${s.toString().padStart(2,"0")}:${c.padStart(2,"0")}:${r.padStart(2,"0")}`).getTime(),g=Date.now();n=Math.max(0,(u-g)/1e3),t.startTime=g,t.actualStartTime=g,a=!0}else if(t.stopwatchMode==="immediate")n=0,a=!0,t.startTime=Date.now(),t.actualStartTime=t.startTime;else{const o=Pt.value;let s=parseInt(I.value)||12;const c=H.value||"00",r=dt.value||"00",l=D.value;l==="PM"&&s<12&&(s+=12),l==="AM"&&s===12&&(s=0);const d=new Date(`${o}T${s.toString().padStart(2,"0")}:${c.padStart(2,"0")}:${r.padStart(2,"0")}`);t.startTime=d.getTime(),t.actualStartTime=t.startTime,n=0,a=!0}t.timerActive=a,t.pauseTime=n,t.duration=n,t.timerName=tt.value.trim();const i={type:t.type,active:t.timerActive,pauseTime:t.pauseTime,startTime:t.startTime,actualStartTime:t.actualStartTime,duration:t.duration,timerName:t.timerName,countdownMode:t.countdownMode,isCreator:!0,roomId:e};sessionStorage.setItem(`timer_owner_${e}`,$t),localStorage.setItem(`timer_state_${e}`,JSON.stringify(i)),p&&E.apiKey!=="DEMO_KEY"&&await set(ref(p,"timers/"+e),{type:t.type,active:t.timerActive,pauseTime:t.pauseTime,startTime:t.startTime,actualStartTime:t.actualStartTime,duration:t.duration,timerName:t.timerName,countdownMode:t.countdownMode,createdAt:serverTimestamp()}),h.classList.remove("hidden"),w.classList.remove("full-width"),Ht({id:e,type:t.type,name:t.timerName||(t.type==="countdown"?"타이머":"스톱워치"),duration:t.duration,createdAt:Date.now()}),window.location.hash=`/${e}`}function Et(e,n=new URLSearchParams){console.log(`[Timer] Entering joinRoom for ID: ${e}`),t.roomId=e,t.isStandalone=e==="standalone"||n.has("v")||n.get("standalone")==="true";const a=n.get("v");if(a){const o=!a.includes("!"),s=o?",":"!",c=a.split(s);if(c.length>=2){const l=o?C(c[0]):parseInt(c[0],36);t.type=l&1?"stopwatch":"countdown";const d=l&2;t.type==="countdown"?t.countdownMode=d?"target":"duration":t.stopwatchMode=d?"target":"immediate",t.timerActive=!!(l&4);const u=17356896e5;t.pauseTime=(o?C(c[1]):parseInt(c[1],36))/1e3||0;const g=c[2];if(g?t.startTime=(o?C(g):parseInt(g,36))+u:t.startTime=null,c.length>=4){const m=c[3];t.actualStartTime=m==="-"?t.startTime:m?(o?C(m):parseInt(m,36))+u:null}if(c.length>=5){const m=c[4];t.duration=m==="-"?t.pauseTime:(o?C(m):parseInt(m,36))/1e3||0}t.timerName=c[5]?decodeURIComponent(c[5]):""}const r={...P(),isCreator:!1,roomId:e};localStorage.setItem(`timer_state_${e}`,JSON.stringify(r)),Ht({id:e,type:t.type,name:t.timerName||(t.type==="countdown"?"타이머":"스톱워치"),duration:t.duration,createdAt:Date.now()})}else t.isStandalone&&n.get("t")&&(t.type=n.get("t"));const i=sessionStorage.getItem(`timer_owner_${e}`);if(t.isCreator=i===$t,Xt(),t.isStandalone)O.classList.add("hidden"),y.title="Standalone Mode (Not synced)",M.classList.add("hidden"),yt.classList.add("hidden");else{M.classList.remove("hidden"),yt.classList.remove("hidden");const o=t.type==="countdown"?"타이머":"스톱워치";K.textContent=`${o} 링크 복사`}if(p&&E.apiKey!=="DEMO_KEY"){const o=ref(p,"timers/"+e),s=onValue(o,c=>{const r=c.val();r?(t.remoteState=r,W(r),y.classList.add("online"),t.isStandalone&&(s(),y.classList.remove("online"),y.title="Standalone Mode (Not synced)")):t.isCreator||(alert("존재하지 않는 타이머입니다."),window.location.hash="")})}else{console.log(`[Timer] Joining room ${e} in local mode (standalone: ${t.isStandalone})`),t.bc&&t.bc.close(),t.bc=new BroadcastChannel("timer_"+e),t.bc.onmessage=s=>{console.log("[Timer] Received BC message:",s.data.msgType),s.data.msgType==="SYNC"?(W(s.data.state),y.classList.add("online"),document.getElementById("sync-text").textContent=t.isStandalone?"개별 모드":"동기화됨",t.isStandalone&&(console.log("[Timer] Standalone sync complete, closing channel."),t.bc.close(),t.bc=null,y.classList.remove("online"))):s.data.msgType==="REQUEST_STATE"&&t.isCreator&&(console.log("[Timer] Host received REQUEST_STATE, broadcasting..."),k())};const o=localStorage.getItem(`timer_state_${e}`);if(o){console.log("[Timer] Found saved state in localStorage");const s=JSON.parse(o);W(s),y.classList.add("online"),document.getElementById("sync-text").textContent=t.isStandalone?"개별 모드":"동기화됨"}if(!t.isCreator){console.log("[Timer] Requesting state from host...");try{t.bc.postMessage({msgType:"REQUEST_STATE"}),setTimeout(()=>{document.getElementById("sync-text").textContent.includes("대기")&&(console.log("[Timer] Still waiting for sync, retrying request..."),t.bc.postMessage({msgType:"REQUEST_STATE"}))},1500)}catch(s){console.error("[Timer] Failed to send REQUEST_STATE:",s)}}!o&&!t.isStandalone&&(y.classList.remove("online"),document.getElementById("sync-text").textContent="동기화 대기 중...")}}function W(e){if(console.log("[Timer] Syncing from remote data:",e),t.type=e.type,t.countdownMode=e.countdownMode||"duration",t.timerActive=t.isStandalone?!0:e.active,t.pauseTime=e.pauseTime,t.actualStartTime=e.actualStartTime,t.isStandalone&&t.timerActive&&!e.startTime?t.startTime=Date.now():t.startTime=e.startTime,t.duration=e.duration,t.timerName=e.timerName||"",Jt.textContent=t.type==="countdown"?"타이머":"스톱워치",Yt.textContent=t.timerName,t.isStandalone){const n=t.type==="countdown"?"타이머":"스톱워치";K.textContent=`${n} 링크 복사`}t.isCreator?(F.classList.remove("hidden"),O.classList.add("hidden"),b()):t.isStandalone?(F.classList.add("hidden"),O.classList.add("hidden")):(F.classList.add("hidden"),O.classList.remove("hidden"))}function b(){const e=Date.now(),n=t.type==="stopwatch"&&t.startTime&&t.startTime>e&&t.timerActive;if(w.classList.remove("hidden"),w.classList.remove("full-width"),h.classList.remove("hidden"),et.classList.add("hidden"),t.type==="countdown"&&t.countdownMode==="target")et.classList.remove("hidden"),w.classList.add("hidden"),h.classList.add("hidden");else if(n)h.classList.add("hidden"),w.classList.add("full-width");else if(t.timerActive)h.textContent="일시정지",h.style.background="#e53e3e";else{const a=t.type==="countdown"?t.pauseTime<t.duration:t.pauseTime>0||t.actualStartTime!==null;h.textContent=a?"재개":"시작",h.style.background="var(--primary-teal)",t.type==="countdown"&&t.pauseTime<=0&&a&&(h.classList.add("hidden"),w.classList.add("full-width"))}}async function ee(){if(!t.isCreator)return;const e=Rt.value;let n=parseInt(S.value)||12;const a=at.value||"00",i=it.value||"00",o=x.value;o==="PM"&&n<12&&(n+=12),o==="AM"&&n===12&&(n=0);const c=new Date(`${e}T${n.toString().padStart(2,"0")}:${a.padStart(2,"0")}:${i.padStart(2,"0")}`).getTime(),r=Date.now(),d={pauseTime:Math.max(0,(c-r)/1e3),startTime:r,active:!0};p&&E.apiKey!=="DEMO_KEY"?await update(ref(p,"timers/"+t.roomId),d):(Object.assign(t,d),t.timerActive=!0,b(),k()),nt.classList.add("hidden")}async function ne(){if(!t.isCreator)return;const e=Date.now(),n=!t.timerActive;let a=t.pauseTime;if(!n){const o=(e-(t.startTime||e))/1e3;t.type==="countdown"?a-=o:a+=o}const i={active:n,startTime:n?e:null,pauseTime:a};n&&t.type==="stopwatch"&&!t.actualStartTime&&(i.actualStartTime=e,t.actualStartTime=e),p&&E.apiKey!=="DEMO_KEY"?await update(ref(p,"timers/"+t.roomId),i):(Object.assign(t,i),t.timerActive=n,b(),k())}async function ae(){if(!t.isCreator)return;const e={active:!1,startTime:null,actualStartTime:null,pauseTime:t.type==="countdown"?t.duration:0};p&&E.apiKey!=="DEMO_KEY"?await update(ref(p,"timers/"+t.roomId),e):(Object.assign(t,e),t.timerActive=!1,h.classList.remove("hidden"),w.classList.remove("full-width"),b(),k())}function Mt(e){if(!e){const m=M.querySelector("strong"),B=m.textContent;m.textContent="개발 중입니다!",M.style.opacity="0.7",setTimeout(()=>{m.textContent=B,M.style.opacity="1"},1500);return}const n=`${window.location.origin}${window.location.pathname}`;let a=0;t.type==="stopwatch"&&(a|=1),(t.type==="countdown"?t.countdownMode:t.stopwatchMode)==="target"&&(a|=2),t.timerActive&&(a|=4);const o=17356896e5,s=$(Math.floor(t.pauseTime*1e3)),c=t.startTime?$(t.startTime-o):"",r=t.actualStartTime===t.startTime&&t.actualStartTime?"-":t.actualStartTime?$(t.actualStartTime-o):"",l=t.duration===t.pauseTime||!t.duration?"-":$(Math.floor(t.duration*1e3)),d=encodeURIComponent(t.timerName||""),u=`${$(a)},${s},${c},${r},${l},${d}`.replace(/,+$/,""),g=`${n}#*${u}`;navigator.clipboard.writeText(g).then(()=>{const m=_t,B=m.innerHTML;m.innerHTML="<strong>복사되었습니다!</strong>",setTimeout(()=>{m.innerHTML=B,V.classList.add("hidden")},1500)})}function P(){return{type:t.type,active:t.timerActive,startTime:t.startTime,pauseTime:t.pauseTime,duration:t.duration,countdownMode:t.countdownMode,actualStartTime:t.actualStartTime,timerName:t.timerName}}function ie(){function e(){t.view==="timer"?oe():t.view==="landing"&&Vt(),requestAnimationFrame(e)}requestAnimationFrame(e)}function oe(){let e=t.pauseTime,n=!1;if(t.timerActive&&t.startTime){const d=(Date.now()-t.startTime)/1e3;t.type==="countdown"?(e=t.pauseTime-d,e<=0&&(e=0,t.isCreator&&se())):d<0?(e=0,n=!0):e=Math.max(0,t.pauseTime+d)}if(t.view==="timer")if(t.type==="stopwatch")if(f.classList.remove("hidden"),t.actualStartTime){const l=new Date(t.actualStartTime);let d=(l.getMonth()+1).toString().padStart(2,"0")+"/"+l.getDate().toString().padStart(2,"0")+" ";d+=l.toLocaleTimeString("ko-KR",{hour12:!0,hour:"numeric",minute:"2-digit",second:"2-digit"}),n?(f.textContent=`⏱️ 스톱워치 시작 대기 중... (${d} 시작)`,f.className="timer-info waiting"):(f.textContent=`시작 시간: ${d}`,f.className="timer-info")}else f.textContent="",f.classList.add("hidden");else if((t.timerActive&&t.startTime||t.countdownMode==="target")&&t.startTime){f.classList.remove("hidden");const d=new Date(t.startTime+t.pauseTime*1e3);let u=(d.getMonth()+1).toString().padStart(2,"0")+"/"+d.getDate().toString().padStart(2,"0")+" ";u+=d.toLocaleTimeString("ko-KR",{hour12:!0,hour:"numeric",minute:"2-digit",second:"2-digit"}),f.textContent=`종료 예정 시간: ${u}`,f.className="timer-info"}else f.textContent="",f.classList.add("hidden");t.isCreator&&t.lastIsWaiting!==n&&(t.lastIsWaiting=n,b());const a=Math.abs(t.type==="stopwatch"?Math.floor(e):Math.round(e)),i=Math.floor(a/86400),o=Math.floor(a%86400/3600),s=Math.floor(a%3600/60),c=a%60;let r="";if(i>0&&(r+=`${i}<span class="timer-day-label">일</span> `),r+=[o.toString().padStart(2,"0"),s.toString().padStart(2,"0"),c.toString().padStart(2,"0")].join(":"),t.type==="stopwatch"){const l=Math.floor(Math.abs(e)%1*100);gt.innerHTML=`${r}<span class="timer-ms">${l.toString().padStart(2,"0")}</span>`}else gt.innerHTML=r}function se(){t.timerActive=!1,t.pauseTime=0,t.startTime=null,b(),re(),ce(),k()}function re(){const e=new(window.AudioContext||window.webkitAudioContext),n=e.createOscillator(),a=e.createGain();n.connect(a),a.connect(e.destination),n.frequency.value=800,n.type="sine",a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),n.start(e.currentTime),n.stop(e.currentTime+.5),setTimeout(()=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination),i.frequency.value=800,i.type="sine",o.gain.setValueAtTime(.3,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),i.start(),i.stop(e.currentTime+.5)},600),setTimeout(()=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination),i.frequency.value=800,i.type="sine",o.gain.setValueAtTime(.3,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),i.start(),i.stop(e.currentTime+.5)},1200)}function ce(){if("Notification"in window)if(Notification.permission==="granted"){const e=t.timerName||(t.type==="countdown"?"타이머":"스톱워치");new Notification("타이머 종료!",{body:`${e}이(가) 종료되었습니다.`,icon:"/favicon.ico",badge:"/favicon.ico"})}else Notification.permission!=="denied"&&Notification.requestPermission().then(e=>{if(e==="granted"){const n=t.timerName||(t.type==="countdown"?"타이머":"스톱워치");new Notification("타이머 종료!",{body:`${n}이(가) 종료되었습니다.`,icon:"/favicon.ico",badge:"/favicon.ico"})}})}function k(){if(p&&E.apiKey!=="DEMO_KEY")update(ref(p,"timers/"+t.roomId),{type:t.type,active:t.timerActive,pauseTime:t.pauseTime,startTime:t.startTime,actualStartTime:t.actualStartTime,duration:t.duration,timerName:t.timerName});else{t.roomId&&localStorage.setItem(`timer_state_${t.roomId}`,JSON.stringify(P())),t.bc||(t.bc=new BroadcastChannel("timer_"+t.roomId)),console.log("[Timer] Broadcasting state via BC:",P());try{t.bc.postMessage({msgType:"SYNC",state:P()})}catch(e){console.error("[Timer] Failed to post SYNC message:",e)}}}function de(){const e=localStorage.getItem("timerList");if(e){const n=JSON.parse(e);lt(n)}}function Ht(e){const n=localStorage.getItem("timerList"),a=n?JSON.parse(n):[],i=a.findIndex(o=>o.id===e.id);i>=0?a[i]=e:a.unshift(e),localStorage.setItem("timerList",JSON.stringify(a)),lt(a)}function le(e){const n=localStorage.getItem("timerList");if(!n)return;const i=JSON.parse(n).filter(o=>o.id!==e);localStorage.setItem("timerList",JSON.stringify(i)),lt(i)}function lt(e){if(!e||e.length===0){Tt.classList.add("hidden"),vt.innerHTML="";return}Tt.classList.remove("hidden"),vt.innerHTML=e.map(n=>me(n)).join(""),e.forEach(n=>{const a=document.getElementById(`timer-item-${n.id}`);if(!a)return;const i=a.querySelector(".timer-list-info");i&&(i.addEventListener("click",()=>{window.location.hash=`/${n.id}`}),i.style.cursor="pointer");const o=a.querySelector(".delete-timer-btn");o&&o.addEventListener("click",c=>{if(c.stopPropagation(),o.classList.contains("confirming"))le(n.id);else{o.classList.add("confirming");const r=o.innerHTML;o.innerHTML=`
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#e53e3e" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <polyline points="9 11 12 14 22 4"/>
                        </svg>
                    `,o.style.color="#e53e3e",o.style.background="#fff5f5",setTimeout(()=>{document.body.contains(o)&&o.classList.contains("confirming")&&(o.classList.remove("confirming"),o.innerHTML=r,o.style.color="",o.style.background="")},3e3)}});const s=a.querySelector(".share-timer-btn");s&&s.addEventListener("click",c=>{c.stopPropagation(),t.roomId=n.id;const r=n.type==="countdown"?"타이머":"스톱워치";K.textContent=`${r} 링크 복사`,V.classList.remove("hidden")})}),Vt()}function me(e){const n=e.type==="countdown"?"타이머":"스톱워치";return`
        <div id="timer-item-${e.id}" class="timer-list-item" data-id="${e.id}">
            <div class="timer-list-info">
                <div class="timer-list-name">${e.name}</div>
                <div class="timer-list-time" id="timer-time-${e.id}">--:--:--</div>
                <div class="timer-list-type" id="timer-type-${e.id}">${n}</div>
            </div>
            <div class="timer-list-actions">
                <button class="timer-list-btn share-timer-btn" title="링크 공유">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                    </svg>
                </button>
                <button class="timer-list-btn delete-timer-btn delete" title="삭제">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                </button>
            </div>
        </div>
    `}function bt(e){const n=new Date,a=e.toDateString()===n.toDateString();let i="";return a||(i+=`${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getDate().toString().padStart(2,"0")} `),i+=e.toLocaleTimeString("ko-KR",{hour12:!0,hour:"numeric",minute:"2-digit"}),i}function Vt(){const e=localStorage.getItem("timerList");if(!e)return;JSON.parse(e).forEach(a=>{const i=document.getElementById(`timer-item-${a.id}`);if(!i)return;const o=document.getElementById(`timer-time-${a.id}`),s=document.getElementById(`timer-type-${a.id}`),c=localStorage.getItem(`timer_state_${a.id}`);if(c){const r=JSON.parse(c),l=Date.now();let d="",u=r.active,g="";if(r.type==="countdown"){let T=r.pauseTime;if(u&&r.startTime){const Y=(l-r.startTime)/1e3;T=r.pauseTime-Y;const Kt=new Date(r.startTime+r.pauseTime*1e3);g=` • 종료 예정: ${bt(Kt)}`}T<=0?(T=0,u=!1,i.classList.add("finished"),g=" • 종료됨"):i.classList.remove("finished");const v=Math.abs(Math.round(T)),N=Math.floor(v/86400),q=Math.floor(v%86400/3600),U=Math.floor(v%3600/60),J=v%60;d=N>0?`${N}일 `:"",d+=`${q.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`}else{let T=r.pauseTime;if(u&&r.startTime&&(T=r.pauseTime+(l-r.startTime)/1e3),r.actualStartTime){const Y=new Date(r.actualStartTime);g=` • 시작: ${bt(Y)}`}i.classList.remove("finished");const v=Math.abs(Math.round(T)),N=Math.floor(v/86400),q=Math.floor(v%86400/3600),U=Math.floor(v%3600/60),J=v%60;d=N>0?`${N}일 `:"",d+=`${q.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`}let m="";u?m=" (진행 중)":r.type==="countdown"&&parseInt(d.replace(/:/g,""))===0?m=" (종료)":m=" (일시정지)",o.textContent=d+m;let B=r.type==="countdown"?"타이머":"스톱워치";if(s&&(s.textContent=B+g),r.timerName&&r.timerName!==a.name){const T=i.querySelector(".timer-list-name");T&&(T.textContent=r.timerName)}}})}function ue(){const e=localStorage.getItem("theme"),n=window.matchMedia("(prefers-color-scheme: dark)");e?document.body.classList.toggle("dark-mode",e==="dark"):document.body.classList.toggle("dark-mode",n.matches),rt(),n.addEventListener("change",a=>{const i=a.matches;document.body.classList.toggle("dark-mode",i),localStorage.setItem("theme",i?"dark":"light"),rt()}),Gt.addEventListener("click",ge)}function ge(){const e=document.body.classList.toggle("dark-mode");localStorage.setItem("theme",e?"dark":"light"),rt()}function rt(){document.body.classList.contains("dark-mode")?(wt.classList.remove("hidden"),St.classList.add("hidden")):(wt.classList.add("hidden"),St.classList.remove("hidden"))}console.log("=== OnlineTimer App Script Loaded ===");Qt();
